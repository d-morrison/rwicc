<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Regression with Interval-Censored Covariates • rwicc</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Regression with Interval-Censored Covariates">
<meta property="og:description" content="Provides functions to simulate and analyze data for a regression model with an interval censored covariate, as described in Morrison et al (2021) &lt;doi:10.1111/biom.13472&gt;.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">rwicc</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/how-to-use-rwicc.html">Introduction to `rwicc`</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/d-morrison/rwicc/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="rwicc" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#rwicc" class="anchor"></a>rwicc</h1></div>
<!-- badges: start -->

<p>rwicc (“Regression With Interval-Censored Covariates”) is an R software package implementing an analysis for a particular regression modeling problem involving interval-censored covariates, as described in “Regression with Interval-Censored Covariates: Application to Cross-Sectional Incidence Estimation” by Morrison, Laeyendecker, and Brookmeyer (Biometrics, 2021): <a href="https://doi.org/10.1111/biom.13472" class="uri">https://doi.org/10.1111/biom.13472</a>.</p>
<p>This analysis uses a joint model for the distributions of the outcome of interest and the interval-censored covariates; the model is maximized using an EM algorithm. The submodel used for the distribution of the interval-censored covariate is somewhat specific to the application of interest (estimation of the mean duration of a biomarker-defined window period for cross-sectional incidence estimation), so this package may not be immediately applicable to other problems. We are publishing it with the goal of making the results in our paper easier to reproduce and with the hope that others might adapt pieces of this code for their own applications. Please feel free to <a href="dmorrison01@ucla.edu">contact us</a> with any questions about the code or the paper!</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>You can install the development version from <a href="https://github.com/">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="st">"d-morrison/rwicc"</span><span class="op">)</span></code></pre></div>
</div>
<div id="example-of-use" class="section level2">
<h2 class="hasAnchor">
<a href="#example-of-use" class="anchor"></a>Example of use</h2>
<p>Here, we simulate some data:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://d-morrison.github.io/rwicc/">rwicc</a></span><span class="op">)</span>
<span class="co">#&gt; Registered S3 method overwritten by 'pryr':</span>
<span class="co">#&gt;   method      from</span>
<span class="co">#&gt;   print.bytes Rcpp</span>

<span class="va">theta_true</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.986</span>, <span class="op">-</span><span class="fl">3.88</span><span class="op">)</span>
<span class="va">study_cohort_size</span> <span class="op">=</span> <span class="fl">4500</span>
<span class="va">preconversion_interval_length</span> <span class="op">=</span> <span class="fl">365</span>
<span class="va">hazard_alpha</span> <span class="op">=</span> <span class="fl">1</span>
<span class="va">hazard_beta</span> <span class="op">=</span> <span class="fl">0.5</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="va">sim_data</span> <span class="op">=</span> <span class="fu"><a href="reference/simulate_interval_censoring.html">simulate_interval_censoring</a></span><span class="op">(</span>
  theta <span class="op">=</span> <span class="va">theta_true</span>,
  study_cohort_size <span class="op">=</span> <span class="va">study_cohort_size</span>,
  preconversion_interval_length <span class="op">=</span> <span class="va">preconversion_interval_length</span>,
  hazard_alpha <span class="op">=</span> <span class="va">hazard_alpha</span>,
  hazard_beta <span class="op">=</span> <span class="va">hazard_beta</span><span class="op">)</span>

<span class="co"># extract the participant-level and observation-level simulated data:</span>
<span class="va">sim_participant_data</span> <span class="op">=</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">pt_data</span>
<span class="va">sim_obs_data</span> <span class="op">=</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">obs_data</span>
<span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">sim_data</span><span class="op">)</span></code></pre></div>
<p>Here, we apply our proposed analysis (this takes a couple of minutes; use argument <code>verbose = TRUE</code> to print progress messages):</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># this call runs the estimation algorithm for the joint modeling approach:</span>
<span class="va">EM_algorithm_outputs</span> <span class="op">=</span> <span class="fu"><a href="reference/fit_joint_model.html">fit_joint_model</a></span><span class="op">(</span>
  obs_level_data <span class="op">=</span> <span class="va">sim_obs_data</span>,
  subject_level_data <span class="op">=</span> <span class="va">sim_participant_data</span>,
  bin_width <span class="op">=</span> <span class="fl">7</span>,
  verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># extract the estimated mean window period duration from the algorithm's results:</span>
<span class="va">mu_est_EM</span> <span class="op">=</span> <span class="va">EM_algorithm_outputs</span><span class="op">$</span><span class="va">Mu</span></code></pre></div>
<p>Next, we perform alternative analyses using midpoint imputation and uniform imputation:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">max_iterations_for_glm_fits</span> <span class="op">=</span> <span class="fl">1000</span> 
<span class="co"># bigglm's default maxit = 8, which is not large enough to ensure convergence for this data.</span>
<span class="co"># I don't think any of the scenarios examined in our paper ever get close to 1000 iterations though; </span>
<span class="co"># this is effectively saying maxit = Inf.</span>

<span class="co"># midpoint imputation:</span>
<span class="op">{</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">biglm</span><span class="op">)</span>
  
  <span class="va">sim_participant_data</span> <span class="op">%&lt;&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>S_midpoint <span class="op">=</span> <span class="va">L</span> <span class="op">+</span> <span class="op">(</span><span class="va">R</span> <span class="op">-</span> <span class="va">L</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/duration.html">ddays</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>
  
  <span class="va">sim_obs_data</span> <span class="op">%&lt;&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span>by <span class="op">=</span> <span class="st">"ID"</span>,
              <span class="va">sim_participant_data</span> <span class="op">%&lt;&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">ID</span>, <span class="va">S_midpoint</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>T_midpoint <span class="op">=</span> <span class="op">(</span><span class="va">O</span> <span class="op">-</span> <span class="va">S_midpoint</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/duration.html">ddays</a></span><span class="op">(</span><span class="fl">365</span><span class="op">)</span><span class="op">)</span>
  
  <span class="va">phi_model_est_midpoint</span> <span class="op">=</span>
    <span class="fu"><a href="https://rdrr.io/pkg/biglm/man/bigglm.html">bigglm</a></span><span class="op">(</span>
      epsilon <span class="op">=</span> <span class="va">tolerance_for_glm_fits</span>,
      maxit <span class="op">=</span> <span class="va">max_iterations_for_glm_fits</span>,
      quiet <span class="op">=</span> <span class="cn">TRUE</span>,
      data <span class="op">=</span> <span class="va">sim_obs_data</span>,
      family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span><span class="op">)</span>,
      <span class="va">Y</span> <span class="op">~</span> <span class="va">T_midpoint</span>
    <span class="op">)</span>
  
  <span class="va">mu_est_midpoint</span> <span class="op">=</span> <span class="fu"><a href="reference/compute_mu.html">compute_mu</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">phi_model_est_midpoint</span><span class="op">)</span><span class="op">)</span>
  
<span class="op">}</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'lubridate'</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     date, intersect, setdiff, union</span>
<span class="co">#&gt; Loading required package: DBI</span>

<span class="co"># uniform imputation:</span>
<span class="op">{</span>
  <span class="va">n_imputations</span> <span class="op">=</span> <span class="fl">100</span> <span class="co"># 10 would be enough</span>
  
  <span class="co"># create a matrix to store the results from each imputed data set</span>
  <span class="va">imputed_coef_ests</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="va">n_imputations</span>,
                             ncol <span class="op">=</span> <span class="fl">2</span>,
                             dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"theta0"</span>, <span class="st">"theta1"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  
  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_imputations</span><span class="op">)</span>
  <span class="op">{</span>
    
    <span class="va">sim_participant_data</span> <span class="op">%&lt;&gt;%</span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>S_imputed <span class="op">=</span>
               <span class="va">L</span> <span class="op">+</span>
               <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span>
                 n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,
                 min <span class="op">=</span> <span class="fl">0</span>,
                 max <span class="op">=</span> <span class="op">(</span><span class="va">R</span> <span class="op">-</span> <span class="va">L</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/duration.html">ddays</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
               <span class="op">)</span><span class="op">)</span>
    
    <span class="va">sim_obs_data</span> <span class="op">%&lt;&gt;%</span>
      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">any_of</a></span><span class="op">(</span><span class="st">"S_imputed"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">sim_participant_data</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">ID</span>, <span class="va">S_imputed</span><span class="op">)</span>,
                by <span class="op">=</span> <span class="st">"ID"</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>T_imputed <span class="op">=</span> <span class="op">(</span><span class="va">O</span> <span class="op">-</span> <span class="va">S_imputed</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/duration.html">ddays</a></span><span class="op">(</span><span class="fl">365</span><span class="op">)</span><span class="op">)</span>
    
    <span class="va">phi_model_est_imputed</span> <span class="op">=</span>
      <span class="fu"><a href="https://rdrr.io/pkg/biglm/man/bigglm.html">bigglm</a></span><span class="op">(</span>
        epsilon <span class="op">=</span> <span class="va">tolerance_for_glm_fits</span>,
        maxit <span class="op">=</span> <span class="va">max_iterations_for_glm_fits</span>,
        quiet <span class="op">=</span> <span class="cn">TRUE</span>,
        data <span class="op">=</span> <span class="va">sim_obs_data</span>,
        family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span><span class="op">)</span>,
        <span class="va">Y</span> <span class="op">~</span> <span class="va">T_imputed</span>
      <span class="op">)</span>
    
    <span class="va">imputed_coef_ests</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">phi_model_est_imputed</span><span class="op">)</span>
    
  <span class="op">}</span>
  
  <span class="va">imputed_coef_ests_mean</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span><span class="op">(</span><span class="va">imputed_coef_ests</span><span class="op">)</span>
  
  <span class="va">mu_est_imputed</span> <span class="op">=</span> <span class="fu"><a href="reference/compute_mu.html">compute_mu</a></span><span class="op">(</span><span class="va">imputed_coef_ests_mean</span><span class="op">)</span>
  
<span class="op">}</span></code></pre></div>
<p>Now, let’s graph the results. First, let’s plot the true and estimated CDFs for the distribution of seroconversion date, for individuals who enroll on the first calendar day of the cohort study:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="va">cum_haz_fn0</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">years_since_study_start</span><span class="op">)</span>
<span class="op">{</span>
  <span class="va">hazard_alpha</span> <span class="op">*</span> <span class="va">years_since_study_start</span> <span class="op">+</span> <span class="va">hazard_beta</span> <span class="op">/</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">years_since_study_start</span><span class="op">^</span><span class="fl">2</span>
<span class="op">}</span>

<span class="va">cum_haz_fn</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">years_since_study_start</span>,
                      <span class="va">`years from study start to enrollment`</span><span class="op">)</span>
<span class="op">{</span>
  <span class="fu">cum_haz_fn0</span><span class="op">(</span><span class="va">years_since_study_start</span><span class="op">)</span> <span class="op">-</span> <span class="fu">cum_haz_fn0</span><span class="op">(</span><span class="va">`years from study start to enrollment`</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">surv_fn</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">years_since_study_start</span>,
                   <span class="va">`years from study start to enrollment`</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fu">cum_haz_fn</span><span class="op">(</span>
    <span class="va">years_since_study_start</span>,
    <span class="va">`years from study start to enrollment`</span>
  <span class="op">)</span><span class="op">)</span>

<span class="va">true_model_label</span> <span class="op">=</span> <span class="st">"Data-generating model"</span>
<span class="va">est_model_label</span> <span class="op">=</span> <span class="st">"Estimated model"</span>

<span class="va">lwd1</span> <span class="op">=</span> <span class="fl">1</span>
<span class="va">omega.hat</span> <span class="op">=</span> <span class="va">EM_algorithm_outputs</span><span class="op">$</span><span class="va">Omega</span> <span class="op">%&lt;&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    <span class="st">"P(S&gt;s|E=0)"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumprod</a></span><span class="op">(</span><span class="va">`P(S&gt;s|S&gt;=s,E=e)`</span><span class="op">)</span>,
    <span class="st">"P(S&gt;=s|E=0)"</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lag</a></span><span class="op">(</span><span class="va">`P(S&gt;s|E=0)`</span>, default <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> 
  <span class="op">)</span>

<span class="va">plot1</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>
    y <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">`P(S&gt;=s|E=0)`</span>,
    x <span class="op">=</span> <span class="op">(</span><span class="va">S</span> <span class="op">-</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">"2001-01-01"</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/duration.html">ddays</a></span><span class="op">(</span><span class="fl">365</span><span class="op">)</span>
  <span class="op">)</span>,
  data <span class="op">=</span> <span class="va">omega.hat</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">S</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_step</a></span><span class="op">(</span>
    direction <span class="op">=</span> <span class="st">"hv"</span>,
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">est_model_label</span>,
        linetype <span class="op">=</span> <span class="va">est_model_label</span><span class="op">)</span>,
    lwd <span class="op">=</span> <span class="va">lwd1</span>
  <span class="op">)</span> <span class="op">+</span>
  
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Calendar time (years since start of study)"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Probability of seroconversion"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html">geom_function</a></span><span class="op">(</span>
    fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
      <span class="fl">1</span> <span class="op">-</span> <span class="fu">surv_fn</span><span class="op">(</span><span class="va">x</span>, <span class="fl">0</span><span class="op">)</span>,
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">true_model_label</span>,
        linetype <span class="op">=</span> <span class="va">true_model_label</span><span class="op">)</span>,
    lwd <span class="op">=</span> <span class="va">lwd1</span>
  <span class="op">)</span> <span class="op">+</span>
  
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html">scale_colour_discrete</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_linetype.html">scale_linetype_discrete</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>
    axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>,
    axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>,
    axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>,
    axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>,
    panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
    panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
    panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
    axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,
    legend.position <span class="op">=</span> <span class="st">"top"</span>,
    legend.text <span class="op">=</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span>,
                   margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">margin</a></span><span class="op">(</span>r <span class="op">=</span> <span class="fl">10</span>, unit <span class="op">=</span> <span class="st">"pt"</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">plot1</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-5-1.png" width="100%"></p>
<p>We can see that our joint modeling approach does not always estimate this distribution very accurately at this sample size. Nevertheless, the next graph will show us that the joint model very accurately estimates the true distribution for <em>P</em>(<em>Y</em>|<em>T</em>) and the true value of <em>μ</em>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org">scales</a></span><span class="op">)</span>


<span class="va">mu_true</span> <span class="op">=</span> <span class="fu"><a href="reference/compute_mu.html">compute_mu</a></span><span class="op">(</span><span class="va">theta_true</span><span class="op">)</span>
<span class="va">phi_true</span> <span class="op">=</span> <span class="fu"><a href="reference/build_phi_function_from_coefs.html">build_phi_function_from_coefs</a></span><span class="op">(</span><span class="va">theta_true</span><span class="op">)</span>
<span class="va">phi_est_joint_modeling</span> <span class="op">=</span> <span class="fu"><a href="reference/build_phi_function_from_coefs.html">build_phi_function_from_coefs</a></span><span class="op">(</span><span class="va">EM_algorithm_outputs</span><span class="op">$</span><span class="va">Theta</span><span class="op">)</span>
<span class="va">phi_est_midpoint</span> <span class="op">=</span> <span class="fu"><a href="reference/build_phi_function_from_coefs.html">build_phi_function_from_coefs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">phi_model_est_midpoint</span><span class="op">)</span><span class="op">)</span>
<span class="va">phi_est_imputed</span> <span class="op">=</span> <span class="fu"><a href="reference/build_phi_function_from_coefs.html">build_phi_function_from_coefs</a></span><span class="op">(</span><span class="va">imputed_coef_ests_mean</span><span class="op">)</span>

<span class="va">true_model_label2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span>sep <span class="op">=</span> <span class="st">""</span>,
                          <span class="st">"'   data-generating model;'~mu == '"</span>,
                          <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">mu_true</span>, digits <span class="op">=</span> <span class="fl">1</span>, nsmall <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,
                          <span class="st">"'~days"</span>
<span class="op">)</span>

<span class="va">midpoint_label</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span>sep <span class="op">=</span> <span class="st">""</span>,
                       <span class="st">"` midpoint imputation;`~hat(mu) == '"</span>,
                       <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">mu_est_midpoint</span>, digits <span class="op">=</span> <span class="fl">1</span>, nsmall <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,
                       <span class="st">"'~days"</span>
<span class="op">)</span>

<span class="va">uniform_label</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span>sep <span class="op">=</span> <span class="st">""</span>,
                      <span class="st">"`uniform imputation;`~hat(mu) == '"</span>,
                      <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">mu_est_imputed</span>, digits <span class="op">=</span> <span class="fl">1</span>, nsmall <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,
                      <span class="st">"'~days"</span>
<span class="op">)</span>

<span class="va">joint_modeling_label</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span>sep <span class="op">=</span> <span class="st">""</span>,
                             <span class="st">"'  joint modeling;'~hat(mu) =='"</span>,
                             <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">mu_est_EM</span>, digits <span class="op">=</span> <span class="fl">1</span>, nsmall <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,
                             <span class="st">"'~days"</span>
<span class="op">)</span>

<span class="va">lwd1</span> <span class="op">=</span> <span class="fl">1</span>


  <span class="va">plot2</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html">geom_function</a></span><span class="op">(</span>
      fun <span class="op">=</span> <span class="va">phi_true</span>,
      lwd <span class="op">=</span> <span class="va">lwd1</span>,
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">true_model_label2</span>, linetype <span class="op">=</span> <span class="va">true_model_label2</span><span class="op">)</span>
    <span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html">geom_function</a></span><span class="op">(</span>
      fun <span class="op">=</span> <span class="va">phi_est_midpoint</span>,
      lwd <span class="op">=</span> <span class="va">lwd1</span>,
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">midpoint_label</span>, linetype <span class="op">=</span> <span class="va">midpoint_label</span><span class="op">)</span>
    <span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html">geom_function</a></span><span class="op">(</span>
      fun <span class="op">=</span> <span class="va">phi_est_imputed</span>,
      lwd <span class="op">=</span> <span class="va">lwd1</span>,
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">uniform_label</span>, linetype <span class="op">=</span> <span class="va">uniform_label</span><span class="op">)</span>
    <span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html">geom_function</a></span><span class="op">(</span>
      fun <span class="op">=</span> <span class="va">phi_est_joint_modeling</span>,
      lwd <span class="op">=</span> <span class="va">lwd1</span>,
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">joint_modeling_label</span>, linetype <span class="op">=</span> <span class="va">joint_modeling_label</span><span class="op">)</span>
    <span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Probability of an MAA-positive blood sample"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Time since seroconversion (years)"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html">scale_colour_discrete</a></span><span class="op">(</span><span class="st">""</span>,   labels <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/label_parse.html">label_parse</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_linetype.html">scale_linetype_discrete</a></span><span class="op">(</span><span class="st">""</span>, labels <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/label_parse.html">label_parse</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>
      panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
      panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
      panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
      axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>
    <span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>
      axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>,
      axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>,
      axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">18</span><span class="op">)</span>,
      axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>,
      legend.text.align <span class="op">=</span> <span class="fl">1</span>,
      legend.box.just <span class="op">=</span> <span class="st">"right"</span>,
      legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span>,
      legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.65</span>, <span class="fl">.85</span><span class="op">)</span>,
      legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>
    <span class="op">)</span>


<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">plot2</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-6-1.png" width="100%"></p>
<p>This example can also be viewed via the R command <code><a href="articles/how-to-use-rwicc.html">vignette("how-to-use-rwicc")</a></code>).</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/d-morrison/rwicc/">https://​github.com/​d-morrison/​rwicc/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/d-morrison/rwicc/issues">https://​github.com/​d-morrison/​rwicc/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Douglas Morrison <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-7195-830X" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Ron Brookmeyer <br><small class="roles"> Author </small>  </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://travis-ci.com/d-morrison/rwicc"><img src="https://travis-ci.com/d-morrison/rwicc.svg?branch=master" alt="Travis build status"></a></li>
<li><a href="https://github.com/d-morrison/rwicc/actions"><img src="https://github.com/d-morrison/rwicc/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Douglas Morrison, Ron Brookmeyer.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
